name: Publish
# 푸시할 때마다 실행
on: [push]
# 릴리즈 할 때마다 실행
#on:
#  release:
#    types: [created]
jobs:
publish-npm-registry:
environment: NPM # 이 부분 매우 중요!
runs-on: ubuntu-latest
permissions:
  contents: read
  packages: write
steps:
  - uses: actions/checkout@v2
  # Setup .npmrc file to publish to GitHub Packages
  - uses: actions/setup-node@v2
    with:
      node-version: '16.x'
      registry-url: 'https://registry.npmjs.org/'
  - run: npm install --legacy-peer-deps # install 실패로 인해 추가한 옵션
  - run: npm publish --access public # public 임에 주의
    env:
      NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}         
publish-github-registry:
runs-on: ubuntu-latest
permissions:
  contents: read
  packages: write
steps:
  - uses: actions/checkout@v2
  # Setup .npmrc file to publish to GitHub Packages
  - uses: actions/setup-node@v2
    with:
      node-version: '16.x'
      registry-url: 'https://npm.pkg.github.com'
  - run: npm install --legacy-peer-deps
  - run: npm publish
    env:
      NODE_AUTH_TOKEN: ${{ secrets.GITHUB_TOKEN }}          
